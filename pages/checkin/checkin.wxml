<!-- pages/checkin/checkin.wxml -->
<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view wx:if="{{error}}" class="error-container">
    <text class="error-text">{{error}}</text>
    <button class="button button-primary button-small" bindtap="retry">重试</button>
  </view>

  <!-- 正常内容 -->
  <view wx:if="{{!loading && !error}}">
    <scroll-view scroll-y="true" class="scroll-container" enhanced="{{true}}" show-scrollbar="{{false}}">
      
      <!-- 顶部统计区域 -->
      <view class="stats-section">
        <text class="section-title">打卡统计</text>
        
        <view class="stats-grid">
          <view class="stat-card">
            <text class="stat-value">{{stats.consecutiveDays || 0}}</text>
            <text class="stat-label">连续天数</text>
          </view>
          <view class="stat-card">
            <text class="stat-value">{{stats.totalSessions || 0}}</text>
            <text class="stat-label">总次数</text>
          </view>
          <view class="stat-card">
            <text class="stat-value">{{stats.totalTime || 0}}</text>
            <text class="stat-label">总时长</text>
          </view>
        </view>
      </view>



      <!-- 当日记录 -->
      <view class="records-section">
        <view class="section-header">
          <text class="section-title">当日记录</text>
          <text class="records-count">共 {{filteredRecords ? filteredRecords.length : 0}} 条</text>
        </view>

        <view wx:if="{{filteredRecords && filteredRecords.length > 0}}" class="records-list">
          <view 
            wx:for="{{filteredRecords}}" 
            wx:key="id" 
            class="record-card"
          >
            <view class="record-header">
              <text class="record-type">{{item.type}}</text>
              <text class="record-duration">{{formatTime(item.duration)}}</text>
            </view>
            <text class="record-time">{{item.date}}</text>
            <text wx:if="{{item.notes}}" class="record-notes">{{item.notes}}</text>
          </view>
        </view>

        <view wx:else class="empty-records">
          <text class="empty-text">暂无冥想记录</text>
          <button class="button button-primary button-medium" bindtap="navigateToMeditation">
            开始冥想
          </button>
        </view>
      </view>

      <!-- 打卡日历 -->
      <view class="calendar-section">
        <view class="calendar-header">
          <text class="section-title">打卡日历</text>
          <view class="calendar-controls">
            <button class="calendar-btn" bindtap="prevMonth">
              <text class="btn-text">‹</text>
            </button>
            <text class="calendar-title">{{currentYear}}年{{currentMonth + 1}}月</text>
            <button class="calendar-btn" bindtap="nextMonth">
              <text class="btn-text">›</text>
            </button>
          </view>
        </view>
        
        <view class="calendar-grid">
          <!-- 星期标题 -->
          <view class="week-header">
            <text class="week-day">日</text>
            <text class="week-day">一</text>
            <text class="week-day">二</text>
            <text class="week-day">三</text>
            <text class="week-day">四</text>
            <text class="week-day">五</text>
            <text class="week-day">六</text>
          </view>
          
          <!-- 日历天数 -->
          <view class="calendar-days">
            <view 
              wx:for="{{calendarData}}" 
              wx:key="dateStr" 
              class="calendar-day {{item.isCurrentMonth ? 'current-month' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.hasRecord ? 'has-record' : ''}}"
            >
              <text class="day-number">{{item.day}}</text>
              <view wx:if="{{item.hasRecord}}" class="record-indicator">
                <text class="indicator-dot"></text>
                <text wx:if="{{item.recordCount > 1}}" class="record-count">{{item.recordCount}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="calendar-legend">
          <view class="legend-item">
            <view class="legend-dot today"></view>
            <text class="legend-text">今天</text>
          </view>
          <view class="legend-item">
            <view class="legend-dot has-record"></view>
            <text class="legend-text">有打卡记录</text>
          </view>
        </view>
      </view>

    </scroll-view>
  </view>
</view>